<script>
  // Formspree endpoint
  const formEndpoint = "https://formspree.io/f/movpzggy";

  async function sendRSVP(status) {
    const name = document.getElementById("name").value.trim() || "(–∏–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ)";
    const comment = document.getElementById("message").value.trim() || "";

    const subject = `RSVP: ${name} ‚Äî ${status}`;
    const message = `–°—Ç–∞—Ç—É—Å: ${status}\n–ò–º—è: ${name}\n\n–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${comment}`;

    try {
      const response = await fetch(formEndpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          _subject: subject,
          name: name,
          status: status,
          message: message,
        }),
      });

      if (response.ok) {
        alert("–°–ø–∞—Å–∏–±–æ! –í–∞—à –æ—Ç–≤–µ—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω üíå");
        document.getElementById("name").value = "";
        document.getElementById("message").value = "";
      } else {
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ üôè");
      }
    } catch (err) {
      alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.");
    }
  }

  document.getElementById("yesBtn").addEventListener("click", () => sendRSVP("–ü—Ä–∏–¥—É"));
  document.getElementById("noBtn").addEventListener("click", () => sendRSVP("–ù–µ —Å–º–æ–≥—É –ø—Ä–∏–π—Ç–∏"));

  /* Sakura petals generator */
  const PETAL_COUNT = 36;
  function rand(min, max) { return Math.random() * (max - min) + min; }

  for (let i = 0; i < PETAL_COUNT; i++) {
    const petal = document.createElement("div");
    petal.className = "petal";
    petal.style.left = rand(0, 100) + "vw";
    const scale = rand(0.7, 1.4);
    petal.style.width = 22 * scale + "px";
    petal.style.height = 24 * scale + "px";
    petal.style.transform = "rotate(" + rand(0, 360) + "deg)";
    const duration = rand(6, 18);
    const delay = rand(-10, 0);
    petal.style.animation = `fall ${duration}s linear ${delay}s infinite`;
    petal.style.opacity = rand(0.85, 1);
    document.body.appendChild(petal);

    (function (p) {
      const amplitude = rand(20, 80);
      const speed = rand(0.002, 0.01);
      let start = performance.now() - rand(0, 10000);
      function frame(t) {
        const progress = (t - start) * speed;
        const x = Math.sin(progress) * amplitude;
        p.style.transform = `translateX(${x}px) rotate(${(progress * 40) % 360}deg)`;
        requestAnimationFrame(frame);
      }
      requestAnimationFrame(frame);
    })(petal);
  }
</script>
